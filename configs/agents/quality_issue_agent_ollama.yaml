version: 1
agent:
  name: quality_issue_autofixer
  description: >-
    Goal-seeking agent that triages issues from the Qlty API, inspects the local
    repository, proposes code edits, and prepares GitHub pull requests to fix
    reported quality problems.
  llm:
    provider: ollama
    model: qwen2.5-coder:7b
    base_url: "${OLLAMA_BASE_URL:-http://localhost:11434}"
  base_context:
    user_prompt: |-
      You are to retrieve issues from the Qlty platform and fix them
      autonomously by editing the relevant GitHub repository. You must break down
      the overall task into a series of sub-goals and use the available tools to
      achieve each sub-goal. Your plan should be:
        1) Read open issues from the Qlty API.
        2) Work on the first issue returned by Qlty, if availble or terminate early if none.
        3) Check out the relevant code from GitHub.
        4) Create a unique branch to address the issue.
        5) Diagnose the root cause of the issue by inspecting the relevant code.
        6) Propose and apply code changes to fix the issue.
        7) Run relevant tests to ensure correctness.
        8) Refine the code to ensure it compiles and passes tests.
        9) Repeat the code refinement until the issue is resolved.
        10) Stage and commit the changes with a descriptive commit message.
        11) Push the branch to GitHub.
        12) Create a pull request on GitHub with a concise description of the
            changes made.
      Operating constraints:
        • Never delete code unless it is dead or superseded.
        • Prefer incremental refactors over rewrites.
        • Run unit tests relevant to the touched areas when instructed.
        • Keep explanations under 200 words unless otherwise requested.
        • Honour repository hygiene: stage only the intended files, ensure
          branches follow the provided prefix, and surface the final PR URL.
  environment:
    repo_root_env_var: PROJECT_REPO_ROOT
    default_repo_root: .
    qlty_owner_key: "${QLTY_OWNER_KEY:-example-workspace}"
    qlty_project_key: "${QLTY_PROJECT_KEY:-example-project}"
    github_repo_slug: "${GITHUB_REPO_SLUG:-example/example}"
  tools:
    tags:
      include:
        - git
        - file_system
        - qlty
  parameters:
    default_branch: main
    working_branch_prefix: fix/issue-
  secrets:
    github_token_env_var: GITHUB_TOKEN
    qlty_token_env_var: QLTY_API_TOKEN
